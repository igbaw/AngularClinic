<c-container class="mt-4">
  <c-row>
    <c-col md="10">
      <c-card>
        <c-card-body>
          <form cForm [formGroup]="form" (ngSubmit)="save()">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Pasien</label>
                  <select cSelect cFormControl formControlName="patientId">
                    <option [ngValue]="''">Pilih...</option>
                    @for (p of patients(); track p.id) {
                      <option [ngValue]="p.id">{{ p.fullName }}</option>
                    }
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Dokter</label>
                  <select cSelect cFormControl formControlName="doctorId">
                    <option [ngValue]="''">Pilih...</option>
                    @for (d of doctors(); track d.id) {
                      <option [ngValue]="d.id">{{ d.fullName }}</option>
                    }
                  </select>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">No. Rekam Medis</label>
                  <input cFormControl formControlName="recordNumber" />
                </div>
              </div>
            </div>

            <h6 class="mt-3">SOAP</h6>
            <div class="mb-3">
              <label class="form-label">Subjective</label>
              <textarea cFormControl rows="3" formControlName="subjective"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Objective</label>
              <textarea cFormControl rows="3" formControlName="objective"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Assessment</label>
              <textarea cFormControl rows="3" formControlName="assessment"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Plan</label>
              <textarea cFormControl rows="3" formControlName="plan"></textarea>
            </div>

            <div class="mb-3">
              <label class="form-label">Lampiran (gambar/pdf/txt, maks {{ 5 }}MB)</label>
              <input type="file" class="form-control" (change)="onFilesSelected($event)" multiple />
              <div class="mt-2">
                @for (a of attachments(); track a.id) {
                  <div class="d-flex align-items-center mb-2">
                    <a [href]="a.url" target="_blank">{{ a.fileName }}</a>
                    <button cButton color="danger" size="sm" class="ms-2" type="button" (click)="removeAttachment(a.id)">Hapus</button>
                  </div>
                }
              </div>
            </div>

            <div class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" role="switch" id="signed" formControlName="signed">
              <label class="form-check-label" for="signed">Tandatangani rekam medis ini</label>
            </div>
            <div class="mb-3" *ngIf="form.get('signed')?.value">
              <label class="form-label">Nama Dokter untuk TTD</label>
              <input cFormControl formControlName="signedBy" placeholder="Nama Dokter" />
            </div>

            <div class="d-flex justify-content-between">
              <a cButton color="secondary" routerLink="../">Batal</a>
              <button cButton color="primary" type="submit">Simpan</button>
            </div>
          </form>
        </c-card-body>
      </c-card>
    </c-col>
  </c-row>
</c-container>