{"version":3,"sources":["../src/index.ts","../src/util.ts"],"sourcesContent":["import { BetterFetchPlugin } from \"@better-fetch/fetch\";\nimport { createConsola } from \"consola\";\nimport { getStatusText } from \"./util\";\n\ntype ConsoleEsque = {\n\tlog: (...args: any[]) => void;\n\terror: (...args: any[]) => void;\n\tsuccess?: (...args: any[]) => void;\n\tfail?: (...args: any[]) => void;\n\twarn?: (...args: any[]) => void;\n};\n\nconst c = createConsola({\n\tfancy: true,\n\tformatOptions: {\n\t\tcolumns: 80,\n\t\tcolors: true,\n\t\tcompact: 10,\n\t\tdate: false,\n\t},\n});\n\nexport interface LoggerOptions {\n\t/**\n\t * Enable or disable the logger\n\t * @default true\n\t */\n\tenabled?: boolean;\n\t/**\n\t * Custom console object\n\t */\n\tconsole?: ConsoleEsque;\n\t/**\n\t * Enable or disable verbose mode\n\t */\n\tverbose?: boolean;\n}\n\nconst defaultConsole: ConsoleEsque = {\n\terror(...args) {\n\t\tc.error(\"\", ...args);\n\t},\n\tlog(...args) {\n\t\tc.info(\"\", ...args);\n\t},\n\tsuccess(...args) {\n\t\tc.success(\"\", ...args);\n\t},\n\tfail(...args) {\n\t\tc.fail(\"\", ...args);\n\t},\n\twarn(...args) {\n\t\tc.warn(\"\", ...args);\n\t},\n};\n\nexport const logger = (options?: LoggerOptions) => {\n\tconst opts = {\n\t\tconsole: defaultConsole,\n\t\tenabled: true,\n\t\t...options,\n\t};\n\tconst { enabled } = opts;\n\treturn {\n\t\tid: \"logger\",\n\t\tname: \"Logger\",\n\t\tversion: \"1.0.0\",\n\t\thooks: {\n\t\t\tonRequest(context) {\n\t\t\t\tif (!enabled) return;\n\t\t\t\topts.console.log(\"Request being sent to:\", context.url.toString());\n\t\t\t},\n\t\t\tasync onSuccess(context) {\n\t\t\t\tif (!enabled) return;\n\t\t\t\tconst log = opts.console.success || opts.console.log;\n\t\t\t\tlog(\"Request succeeded\", context.data);\n\t\t\t},\n\t\t\tonRetry(response) {\n\t\t\t\tif (!enabled) return;\n\t\t\t\tconst log = opts.console.warn || opts.console.log;\n\t\t\t\tlog(\n\t\t\t\t\t\"Retrying request...\",\n\t\t\t\t\t\"Attempt:\",\n\t\t\t\t\t(response.request.retryAttempt || 0) + 1,\n\t\t\t\t);\n\t\t\t},\n\t\t\tasync onError(context) {\n\t\t\t\tif (!enabled) return;\n\t\t\t\tconst log = opts.console.fail || opts.console.error;\n\t\t\t\tlet obj: any;\n\t\t\t\ttry {\n\t\t\t\t\tif (opts.verbose) {\n\t\t\t\t\t\tconst res = context.response.clone();\n\t\t\t\t\t\tconst json = await res.json();\n\t\t\t\t\t\tif (json) {\n\t\t\t\t\t\t\tobj = json;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t\tlog(\n\t\t\t\t\t\"Request failed with status: \",\n\t\t\t\t\tcontext.response.status,\n\t\t\t\t\t`(${\n\t\t\t\t\t\tcontext.response.statusText ||\n\t\t\t\t\t\tgetStatusText(context.response.status)\n\t\t\t\t\t})`,\n\t\t\t\t);\n\t\t\t\toptions?.verbose && obj && opts.console.error(obj);\n\t\t\t},\n\t\t},\n\t} satisfies BetterFetchPlugin;\n};\n","export function getStatusText(status: number) {\n\tswitch (status) {\n\t\tcase 100:\n\t\t\treturn \"Continue\";\n\t\tcase 101:\n\t\t\treturn \"Switching Protocols\";\n\t\tcase 102:\n\t\t\treturn \"Processing\";\n\t\tcase 200:\n\t\t\treturn \"OK\";\n\t\tcase 201:\n\t\t\treturn \"Created\";\n\t\tcase 202:\n\t\t\treturn \"Accepted\";\n\t\tcase 203:\n\t\t\treturn \"Non-Authoritative Information\";\n\t\tcase 204:\n\t\t\treturn \"No Content\";\n\t\tcase 205:\n\t\t\treturn \"Reset Content\";\n\t\tcase 206:\n\t\t\treturn \"Partial Content\";\n\t\tcase 207:\n\t\t\treturn \"Multi-Status\";\n\t\tcase 208:\n\t\t\treturn \"Already Reported\";\n\t\tcase 226:\n\t\t\treturn \"IM Used\";\n\t\tcase 300:\n\t\t\treturn \"Multiple Choices\";\n\t\tcase 301:\n\t\t\treturn \"Moved Permanently\";\n\t\tcase 302:\n\t\t\treturn \"Found\";\n\t\tcase 303:\n\t\t\treturn \"See Other\";\n\t\tcase 304:\n\t\t\treturn \"Not Modified\";\n\t\tcase 305:\n\t\t\treturn \"Use Proxy\";\n\t\tcase 307:\n\t\t\treturn \"Temporary Redirect\";\n\t\tcase 308:\n\t\t\treturn \"Permanent Redirect\";\n\t\tcase 400:\n\t\t\treturn \"Bad Request\";\n\t\tcase 401:\n\t\t\treturn \"Unauthorized\";\n\t\tcase 402:\n\t\t\treturn \"Payment Required\";\n\t\tcase 403:\n\t\t\treturn \"Forbidden\";\n\t\tcase 404:\n\t\t\treturn \"Not Found\";\n\t\tcase 405:\n\t\t\treturn \"Method Not Allowed\";\n\t\tcase 406:\n\t\t\treturn \"Not Acceptable\";\n\t\tcase 407:\n\t\t\treturn \"Proxy Authentication Required\";\n\t\tcase 408:\n\t\t\treturn \"Request Timeout\";\n\t\tcase 409:\n\t\t\treturn \"Conflict\";\n\t\tcase 410:\n\t\t\treturn \"Gone\";\n\t\tcase 411:\n\t\t\treturn \"Length Required\";\n\t\tcase 412:\n\t\t\treturn \"Precondition Failed\";\n\t\tcase 413:\n\t\t\treturn \"Payload Too Large\";\n\t\tcase 414:\n\t\t\treturn \"URI Too Long\";\n\t\tcase 415:\n\t\t\treturn \"Unsupported Media Type\";\n\t\tcase 416:\n\t\t\treturn \"Range Not Satisfiable\";\n\t\tcase 417:\n\t\t\treturn \"Expectation Failed\";\n\t\tcase 418:\n\t\t\treturn \"I'm a teapot\";\n\t\tcase 421:\n\t\t\treturn \"Misdirected Request\";\n\t\tcase 422:\n\t\t\treturn \"Unprocessable Entity\";\n\t\tcase 423:\n\t\t\treturn \"Locked\";\n\t\tcase 424:\n\t\t\treturn \"Failed Dependency\";\n\t\tcase 425:\n\t\t\treturn \"Too Early\";\n\t\tcase 426:\n\t\t\treturn \"Upgrade Required\";\n\t\tcase 428:\n\t\t\treturn \"Precondition Required\";\n\t\tcase 429:\n\t\t\treturn \"Too Many Requests\";\n\t\tcase 431:\n\t\t\treturn \"Request Header Fields Too Large\";\n\t\tcase 451:\n\t\t\treturn \"Unavailable For Legal Reasons\";\n\t\tcase 500:\n\t\t\treturn \"Internal Server Error\";\n\t\tcase 501:\n\t\t\treturn \"Not Implemented\";\n\t\tcase 502:\n\t\t\treturn \"Bad Gateway\";\n\t\tcase 503:\n\t\t\treturn \"Service Unavailable\";\n\t\tcase 504:\n\t\t\treturn \"Gateway Timeout\";\n\t\tcase 505:\n\t\t\treturn \"HTTP Version Not Supported\";\n\t\tcase 506:\n\t\t\treturn \"Variant Also Negotiates\";\n\t\tcase 507:\n\t\t\treturn \"Insufficient Storage\";\n\t\tcase 508:\n\t\t\treturn \"Loop Detected\";\n\t\tcase 510:\n\t\t\treturn \"Not Extended\";\n\t\tcase 511:\n\t\t\treturn \"Network Authentication Required\";\n\t\tdefault:\n\t\t\treturn \"Unknown\";\n\t}\n}\n"],"mappings":"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","names":[]}