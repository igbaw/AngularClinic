var a=(e,i,c)=>new Promise((t,r)=>{var o=d=>{try{u(c.next(d))}catch(m){r(m)}},n=d=>{try{u(c.throw(d))}catch(m){r(m)}},u=d=>d.done?t(d.value):Promise.resolve(d.value).then(o,n);u((c=c.apply(e,i)).next())});import"arctic";import{parseJWT as B}from"oslo/jwt";import"@better-fetch/fetch";var f=class extends Error{constructor(i,c,t){super(i),this.name="BetterAuthError",this.message=i,this.cause=c}};import{OAuth2Tokens as S}from"arctic";function E(e){try{return new URL(e).pathname!=="/"}catch(i){throw new f(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function b(e,i="/api/auth"){return E(e)?e:(i=i.startsWith("/")?i:`/${i}`,`${e}${i}`)}function U(e,i){if(e)return b(e,i);let c=(process==null?void 0:process.env)||{},t=c.BETTER_AUTH_URL||c.NEXT_PUBLIC_BETTER_AUTH_URL||c.PUBLIC_BETTER_AUTH_URL||c.NUXT_PUBLIC_BETTER_AUTH_URL||c.NUXT_PUBLIC_AUTH_URL||(c.BASE_URL!=="/"?c.BASE_URL:void 0);if(t)return b(t,i);if(typeof window!="undefined")return b(window.location.origin,i)}import{betterFetch as C}from"@better-fetch/fetch";function s(e,i){return i||`${U()}/callback/${e}`}function l(o){return a(this,arguments,function*({code:e,codeVerifier:i,redirectURI:c,options:t,tokenEndpoint:r}){let n=new URLSearchParams;n.set("grant_type","authorization_code"),n.set("code",e),i&&n.set("code_verifier",i),n.set("redirect_uri",c),n.set("client_id",t.clientId),n.set("client_secret",t.clientSecret);let{data:u,error:d}=yield C(r,{method:"POST",body:n,headers:{"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth"}});if(d)throw d;return new S(u)})}var v=e=>{let i="https://appleid.apple.com/auth/token";return{id:"apple",name:"Apple",createAuthorizationURL({state:t,scopes:r,redirectURI:o}){let n=r||["email","name","openid"];return new URL(`https://appleid.apple.com/auth/authorize?client_id=${e.clientId}&response_type=code&redirect_uri=${o||e.redirectURI}&scope=${n.join(" ")}&state=${t}`)},validateAuthorizationCode:(t,r,o)=>a(void 0,null,function*(){return l({code:t,codeVerifier:r,redirectURI:o||s("apple",e.redirectURI),options:e,tokenEndpoint:i})}),getUserInfo(t){return a(this,null,function*(){var o;let r=(o=B(t.idToken()))==null?void 0:o.payload;return r?{user:{id:r.sub,name:r.name,email:r.email,emailVerified:r.email_verified==="true"},data:r}:null})}}};import{betterFetch as G}from"@better-fetch/fetch";import{Discord as F}from"arctic";var R=e=>{let i=new F(e.clientId,e.clientSecret,s("discord",e.redirectURI));return{id:"discord",name:"Discord",createAuthorizationURL({state:t,scopes:r}){let o=r||["email"];return i.createAuthorizationURL(t,o)},validateAuthorizationCode:(t,r,o)=>a(void 0,null,function*(){return l({code:t,codeVerifier:r,redirectURI:o||s("discord",e.redirectURI),options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"})}),getUserInfo(t){return a(this,null,function*(){let{data:r,error:o}=yield G("https://discord.com/api/users/@me",{auth:{type:"Bearer",token:t.accessToken()}});return o?null:{user:{id:r.id,name:r.display_name||r.username||"",email:r.email,emailVerified:r.verified},data:r}})}}};import{betterFetch as V}from"@better-fetch/fetch";import{Facebook as $}from"arctic";var w=e=>{let i=new $(e.clientId,e.clientSecret,s("facebook",e.redirectURI));return{id:"facebook",name:"Facebook",createAuthorizationURL({state:t,scopes:r}){let o=r||["email","public_profile"];return i.createAuthorizationURL(t,o)},validateAuthorizationCode:(t,r,o)=>a(void 0,null,function*(){return l({code:t,codeVerifier:r,redirectURI:o||s("facebook",e.redirectURI),options:e,tokenEndpoint:"https://graph.facebook.com/v16.0/oauth/access_token"})}),getUserInfo(t){return a(this,null,function*(){let{data:r,error:o}=yield V("https://graph.facebook.com/me",{auth:{type:"Bearer",token:t.accessToken()}});return o?null:{user:{id:r.id,name:r.name,email:r.email,emailVerified:r.email_verified},data:r}})}}};import{betterFetch as I}from"@better-fetch/fetch";import{GitHub as D}from"arctic";var P=({clientId:e,clientSecret:i,redirectURI:c})=>{let t=new D(e,i,s("github",c));return{id:"github",name:"Github",createAuthorizationURL({state:o,scopes:n}){let u=n||["user:email"];return t.createAuthorizationURL(o,u)},validateAuthorizationCode:o=>a(void 0,null,function*(){return yield t.validateAuthorizationCode(o)}),getUserInfo(o){return a(this,null,function*(){var m,_,A,y;let{data:n,error:u}=yield I("https://api.github.com/user",{auth:{type:"Bearer",token:o.accessToken()}});if(u)return null;let d=!1;if(!n.email){let{data:p,error:z}=yield I("https://api.github.com/user/emails",{auth:{type:"Bearer",token:o.accessToken()}});z||(n.email=(_=(m=p.find(h=>h.primary))!=null?m:p[0])==null?void 0:_.email,d=(y=(A=p.find(h=>h.email===n.email))==null?void 0:A.verified)!=null?y:!1)}return{user:{id:n.id,name:n.name,email:n.email,image:n.avatar_url,emailVerified:d,createdAt:new Date,updatedAt:new Date},data:n}})}}};import{Google as N}from"arctic";import{parseJWT as W}from"oslo/jwt";import{createConsola as H}from"consola";var g=H({formatOptions:{date:!1,colors:!0,compact:!0},defaults:{tag:"Better Auth"}}),j=e=>({log:(...i)=>{!(e!=null&&e.disabled)&&g.log("",...i)},error:(...i)=>{!(e!=null&&e.disabled)&&g.error("",...i)},warn:(...i)=>{!(e!=null&&e.disabled)&&g.warn("",...i)},info:(...i)=>{!(e!=null&&e.disabled)&&g.info("",...i)},debug:(...i)=>{!(e!=null&&e.disabled)&&g.debug("",...i)},box:(...i)=>{!(e!=null&&e.disabled)&&g.box("",...i)},success:(...i)=>{!(e!=null&&e.disabled)&&g.success("",...i)},break:(...i)=>{!(e!=null&&e.disabled)&&console.log(`
`)}}),k=j();var x=e=>{let i=new N(e.clientId,e.clientSecret,s("google",e.redirectURI));return{id:"google",name:"Google",createAuthorizationURL({state:t,scopes:r,codeVerifier:o,redirectURI:n}){if(!e.clientId||!e.clientSecret)throw k.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new f("CLIENT_ID_AND_SECRET_REQUIRED");if(!o)throw new f("codeVerifier is required for Google");let u=r||["email","profile"];return i.createAuthorizationURL(t,o,u)},validateAuthorizationCode:(t,r,o)=>a(void 0,null,function*(){return l({code:t,codeVerifier:r,redirectURI:o||s("google",e.redirectURI),options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"})}),getUserInfo(t){return a(this,null,function*(){var o;if(!t.idToken)return null;let r=(o=W(t.idToken()))==null?void 0:o.payload;return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:r.email_verified},data:r}})}}};import{betterFetch as X}from"@better-fetch/fetch";import{Spotify as q}from"arctic";var T=e=>{let i=new q(e.clientId,e.clientSecret,s("spotify",e.redirectURI));return{id:"spotify",name:"Spotify",createAuthorizationURL({state:t,scopes:r}){let o=r||["user-read-email"];return i.createAuthorizationURL(t,o)},validateAuthorizationCode:(t,r,o)=>a(void 0,null,function*(){return l({code:t,codeVerifier:r,redirectURI:o||s("spotify",e.redirectURI),options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"})}),getUserInfo(t){return a(this,null,function*(){var n;let{data:r,error:o}=yield X("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken()}`}});return o?null:{user:{id:r.id,name:r.display_name,email:r.email,image:(n=r.images[0])==null?void 0:n.url,emailVerified:!1},data:r}})}}};import{betterFetch as J}from"@better-fetch/fetch";import{Twitch as K}from"arctic";var O=e=>{let i=new K(e.clientId,e.clientSecret,s("twitch",e.redirectURI));return{id:"twitch",name:"Twitch",createAuthorizationURL({state:t,scopes:r}){let o=r||["activity:write","read"];return i.createAuthorizationURL(t,o)},validateAuthorizationCode:(t,r,o)=>a(void 0,null,function*(){return l({code:t,codeVerifier:r,redirectURI:o||s("twitch",e.redirectURI),options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"})}),getUserInfo(t){return a(this,null,function*(){let{data:r,error:o}=yield J("https://api.twitch.tv/helix/users",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken()}`}});return o?null:{user:{id:r.sub,name:r.preferred_username,email:r.email,image:r.picture,emailVerified:!1},data:r}})}}};import{betterFetch as M}from"@better-fetch/fetch";import{Twitter as Q}from"arctic";var L=e=>{let i=new Q(e.clientId,e.clientSecret,s("twitter",e.redirectURI));return{id:"twitter",name:"Twitter",createAuthorizationURL(t){let r=t.scopes||["account_info.read"];return i.createAuthorizationURL(t.state,t.codeVerifier,r)},validateAuthorizationCode:(t,r,o)=>a(void 0,null,function*(){return l({code:t,codeVerifier:r,redirectURI:o||s("twitch",e.redirectURI),options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"})}),getUserInfo(t){return a(this,null,function*(){let{data:r,error:o}=yield M("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken()}`}});return o||!r.data.email?null:{user:{id:r.data.id,name:r.data.name,email:r.data.email,image:r.data.profile_image_url,emailVerified:r.data.verified||!1},data:r}})}}};import"arctic";var Y={apple:v,discord:R,facebook:w,github:P,google:x,spotify:T,twitch:O,twitter:L},pr=Object.keys(Y);export{v as apple,R as discord,w as facebook,P as github,x as google,pr as oAuthProviderList,Y as oAuthProviders,T as spotify,O as twitch,L as twitter};
