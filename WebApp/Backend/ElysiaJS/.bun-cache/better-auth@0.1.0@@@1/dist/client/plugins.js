var w=Object.defineProperty,x=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var b=(e,t,s)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,u=(e,t)=>{for(var s in t||(t={}))C.call(t,s)&&b(e,s,t[s]);if(T)for(var s of T(t))B.call(t,s)&&b(e,s,t[s]);return e},d=(e,t)=>x(e,k(t));var p=(e,t,s)=>b(e,typeof t!="symbol"?t+"":t,s);var l=(e,t,s)=>new Promise((a,r)=>{var i=c=>{try{n(s.next(c))}catch(f){r(f)}},o=c=>{try{n(s.throw(c))}catch(f){r(f)}},n=c=>c.done?a(c.value):Promise.resolve(c.value).then(i,o);n((s=s.apply(e,t)).next())});import{atom as O}from"nanostores";var y=class extends Error{constructor(s,a){super(s);p(this,"path");this.path=a}},P=class{constructor(t){this.s=t;p(this,"statements");this.statements=t}newRole(t){return new S(t)}},S=class e{constructor(t){p(this,"statements");this.statements=t}authorize(t,s){for(let[a,r]of Object.entries(t)){let i=this.statements[a];if(!i)return{success:!1,error:`You are not allowed to access resource: ${a}`};let o=s==="OR"?r.some(n=>i.includes(n)):r.every(n=>i.includes(n));return o?{success:o}:{success:!1,error:`unauthorized to access resource "${a}"`}}return{success:!1,error:"Not authorized"}}static fromString(t){let s=JSON.parse(t);if(typeof s!="object")throw new y("statements is not an object",".");for(let[a,r]of Object.entries(s)){if(typeof a!="string")throw new y("invalid resource identifier",a);if(!Array.isArray(r))throw new y("actions is not an array",a);for(let i=0;i<r.length;i++)if(typeof r[i]!="string")throw new y("action is not a string",`${a}[${i}]`)}return new e(s)}toString(){return JSON.stringify(this.statements)}};var F=e=>new P(e),U={organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]},A=F(U),K=A.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"]}),H=A.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]}),J=A.newRole({organization:[],member:[],invitation:[]});import{createFetch as he}from"@better-fetch/fetch";import"nanostores";import{betterFetch as oe}from"@better-fetch/fetch";import{atom as ve}from"nanostores";import"@better-fetch/fetch";import{atom as E,onMount as I}from"nanostores";var h=(e,t,s,a)=>{let r=E({data:null,error:null,isPending:!1}),i=()=>{let n=typeof a=="function"?a({data:r.get().data,error:r.get().error,isPending:r.get().isPending}):a;return s(t,d(u({},n),{onSuccess:f=>l(void 0,null,function*(){var m;r.set({data:f.data,error:null,isPending:!1}),yield(m=n==null?void 0:n.onSuccess)==null?void 0:m.call(n,f)}),onError(f){return l(this,null,function*(){var m;r.set({error:f.error,data:null,isPending:!1}),yield(m=n==null?void 0:n.onError)==null?void 0:m.call(n,f)})},onRequest(f){return l(this,null,function*(){var R;let m=r.get();r.set({isPending:!0,data:m.data,error:m.error}),yield(R=n==null?void 0:n.onRequest)==null?void 0:R.call(n,f)})}}))};e=Array.isArray(e)?e:[e];let o=!1;for(let n of e)n.subscribe(()=>{o?i():I(r,()=>(i(),o=!0,()=>{r.off(),n.off()}))});return r};var Ze=e=>{let t=O(void 0),s=O(!1),a=O(!1);return{id:"organization",$InferServerPlugin:{},getActions:r=>({$Infer:{ActiveOrganization:{},Organization:{},Invitation:{},Member:{}},organization:{setActive(i){t.set(i)},hasPermission:i=>l(void 0,null,function*(){return yield r("/organization/has-permission",u({method:"POST",body:{permission:i.permission}},i.fetchOptions))})}}),getAtoms:r=>{let i=h(s,"/organization/list",r,{method:"GET"}),o=h([t,a],"/organization/activate",r,()=>({method:"POST",credentials:"include",body:{orgId:t.get()}}));return{_listOrg:s,_activeOrgSignal:a,activeOrganization:o,listOrganizations:i}},atomListeners:[{matcher(r){return r==="/organization/create"||r==="/organization/delete"},signal:"_listOrg"},{matcher(r){return r.startsWith("/organization")},signal:"_activeOrgSignal"}]}};var rt=()=>({id:"username",$InferServerPlugin:{}});import{WebAuthnError as z,startAuthentication as $,startRegistration as M}from"@simplewebauthn/browser";import{createConsola as L}from"consola";var g=L({formatOptions:{date:!1,colors:!0,compact:!0},defaults:{tag:"Better Auth"}}),_=e=>({log:(...t)=>{!(e!=null&&e.disabled)&&g.log("",...t)},error:(...t)=>{!(e!=null&&e.disabled)&&g.error("",...t)},warn:(...t)=>{!(e!=null&&e.disabled)&&g.warn("",...t)},info:(...t)=>{!(e!=null&&e.disabled)&&g.info("",...t)},debug:(...t)=>{!(e!=null&&e.disabled)&&g.debug("",...t)},box:(...t)=>{!(e!=null&&e.disabled)&&g.box("",...t)},success:(...t)=>{!(e!=null&&e.disabled)&&g.success("",...t)},break:(...t)=>{!(e!=null&&e.disabled)&&console.log(`
`)}}),it=_();import{atom as N}from"nanostores";var q=(e,{_listPasskeys:t})=>({signIn:{passkey:(r,i)=>l(void 0,null,function*(){let o=yield e("/passkey/generate-authenticate-options",{method:"POST",body:{email:r==null?void 0:r.email,callbackURL:r==null?void 0:r.callbackURL}});if(!o.data)return o;try{let n=yield $(o.data,(r==null?void 0:r.autoFill)||!1),c=yield e("/passkey/verify-authentication",u(u({body:{response:n}},r==null?void 0:r.fetchOptions),i));if(!c.data)return c}catch(n){console.log(n)}})},passkey:{addPasskey:(r,i)=>l(void 0,null,function*(){let o=yield e("/passkey/generate-register-options",{method:"GET"});if(!o.data)return o;try{let n=yield M(o.data),c=yield e("/passkey/verify-registration",d(u(u({},r==null?void 0:r.fetchOptions),i),{body:{response:n,name:r==null?void 0:r.name}}));if(!c.data)return c;t.set(Math.random())}catch(n){return n instanceof z?n.code==="ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED"?{data:null,error:{message:"previously registered",status:400,statusText:"BAD_REQUEST"}}:n.code==="ERROR_CEREMONY_ABORTED"?{data:null,error:{message:"registration cancelled",status:400,statusText:"BAD_REQUEST"}}:{data:null,error:{message:n.message,status:400,statusText:"BAD_REQUEST"}}:{data:null,error:{message:n instanceof Error?n.message:"unknown error",status:500,statusText:"INTERNAL_SERVER_ERROR"}}}})},$Infer:{}}),mt=()=>{let e=N();return{id:"passkey",$InferServerPlugin:{},getActions:t=>q(t,{_listPasskeys:e}),getAtoms(t){return{listPasskeys:h(e,"/passkey/list-user-passkeys",t,{method:"GET",credentials:"include"}),_listPasskeys:e}},pathMethods:{"/passkey/register":"POST","/passkey/authenticate":"POST"},atomListeners:[{matcher(t){return t==="/passkey/verify-registration"||t==="/passkey/delete-passkey"},signal:"_listPasskeys"}]}};var yt=(e={redirect:!0,twoFactorPage:"/"})=>({id:"two-factor",$InferServerPlugin:{},atomListeners:[{matcher:s=>s==="/two-factor/enable"||s==="/two-factor/send-otp"||s==="/two-factor/disable",signal:"_sessionSignal"}],pathMethods:{"/two-factor/disable":"POST","/two-factor/enable":"POST","/two-factor/send-otp":"POST"},fetchPlugins:[{id:"two-factor",name:"two-factor",hooks:{onSuccess(s){return l(this,null,function*(){var a;(a=s.data)!=null&&a.twoFactorRedirect&&(e.redirect||e.twoFactorPage)&&typeof window!="undefined"&&(window.location.href=e.twoFactorPage)})}}}]});export{q as getPasskeyActions,Ze as organizationClient,mt as passkeyClient,yt as twoFactorClient,rt as usernameClient};
