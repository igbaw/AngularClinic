var w=Object.defineProperty,T=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var b=(e,o,t)=>o in e?w(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,a=(e,o)=>{for(var t in o||(o={}))E.call(o,t)&&b(e,t,o[t]);if(C)for(var t of C(o))R.call(o,t)&&b(e,t,o[t]);return e},k=(e,o)=>T(e,O(o));var m=(e,o,t)=>new Promise((n,r)=>{var s=i=>{try{c(t.next(i))}catch(p){r(p)}},u=i=>{try{c(t.throw(i))}catch(p){r(p)}},c=i=>i.done?n(i.value):Promise.resolve(i.value).then(s,u);c((t=t.apply(e,o)).next())});var H=(e,o)=>{let t={};for(let[n,r]of Object.entries(e))t[n]=s=>r(k(a({},s),{context:a(a({},o),s.context)})),t[n].path=r.path,t[n].method=r.method,t[n].options=r.options,t[n].headers=r.headers;return t},V=(e,o)=>t=>m(void 0,null,function*(){var s,u;for(let c of e.options.plugins||[])if((s=c.hooks)!=null&&s.before){for(let i of c.hooks.before)if(i.matcher(a(a({},t),o))){let f=yield i.handler(t);f&&"context"in f&&(t=a(a(a({},t),f.context),o))}}let n=o(k(a({},t),{context:a(a({},e),t.context)})),r=n;for(let c of e.options.plugins||[])if((u=c.hooks)!=null&&u.after){for(let i of c.hooks.after)if(i.matcher(t)){let f=Object.assign(t,{returned:n}),l=yield i.handler(f);l&&"response"in l&&(r=l.response)}}return r});var h=class extends Error{constructor(o,t,n){super(o),this.name="BetterAuthError",this.message=o,this.cause=t}};function U(e){try{return new URL(e).pathname!=="/"}catch(o){throw new h(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function x(e,o="/api/auth"){return U(e)?e:(o=o.startsWith("/")?o:`/${o}`,`${e}${o}`)}function X(e,o){if(e)return x(e,o);let t=(process==null?void 0:process.env)||{},n=t.BETTER_AUTH_URL||t.NEXT_PUBLIC_BETTER_AUTH_URL||t.PUBLIC_BETTER_AUTH_URL||t.NUXT_PUBLIC_BETTER_AUTH_URL||t.NUXT_PUBLIC_AUTH_URL||(t.BASE_URL!=="/"?t.BASE_URL:void 0);if(n)return x(n,o);if(typeof window!="undefined")return x(window.location.origin,o)}var A=(e,o)=>{for(let t in e){if(!e.hasOwnProperty(t))continue;let n=e[t];typeof n=="object"&&n!==null?o[t]=A(n,n.constructor()):o[t]=n}return o},y=e=>A(e,e.constructor());import{TimeSpan as S}from"oslo";function W(e){var s;let t=!!((s=e.advanced)!=null&&s.useSecureCookies)||process.env.NODE_ENV!=="development"&&process.env.NODE_ENV!=="test"?"__Secure-":"",n="better-auth",r=new S(7,"d").seconds();return{sessionToken:{name:`${t}${n}.session_token`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!!t,maxAge:r}},csrfToken:{name:`${t?"__Host-":""}${n}.csrf_token`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!!t,maxAge:60*60*24*7}},state:{name:`${t}${n}.state`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!!t,maxAge:60*15}},pkCodeVerifier:{name:`${t}${n}.pk_code_verifier`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!!t,maxAge:60*15}},dontRememberToken:{name:`${t}${n}.dont_remember`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!!t}},nonce:{name:`${t}${n}.nonce`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!!t,maxAge:60*15}}}}function K(e){var s;let t=!!((s=e.advanced)!=null&&s.useSecureCookies)||process.env.NODE_ENV==="production"?"__Secure-":"",n="better-auth";function r(u,c){return{name:process.env.NODE_ENV==="production"?`${t}${n}.${u}`:`${n}.${u}`,options:a({secure:!!t,sameSite:"lax",path:"/",maxAge:60*15},c)}}return r}function Q(e,o,t,n){return m(this,null,function*(){let r=e.context.authCookies.sessionToken.options;r.maxAge=t?void 0:r.maxAge,yield e.setSignedCookie(e.context.authCookies.sessionToken.name,o,e.context.secret,r),t&&(yield e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options))})}function Y(e){e.setCookie(e.context.authCookies.sessionToken.name,"",{maxAge:0}),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{maxAge:0})}function Z(e){let o=new Map;return e.split(", ").forEach(n=>{let[r,...s]=n.split("; "),[u,c]=r.split("="),i={value:c};s.forEach(p=>{let[f,l]=p.split("=");i[f.toLowerCase()]=l||!0}),o.set(u,i)}),o}var oe=(e,o=!1)=>{let t=new Date;return new Date(t.getTime()+(o?e*1e3:e))};function re(e){let o="127.0.0.1";if(process.env.NODE_ENV==="test")return o;let t=["x-client-ip","x-forwarded-for","cf-connecting-ip","fastly-client-ip","x-real-ip","x-cluster-client-ip","x-forwarded","forwarded-for","forwarded"];for(let n of t){let r=e.headers.get(n);if(typeof r=="string"){let s=r.split(",")[0].trim();if(s)return s}}return null}var ie={isAction:!1};import{alphabet as v,generateRandomString as L}from"oslo/crypto";var ue=()=>L(36,v("a-z","0-9"));import{createConsola as P}from"consola";var d=P({formatOptions:{date:!1,colors:!0,compact:!0},defaults:{tag:"Better Auth"}}),$=e=>({log:(...o)=>{!(e!=null&&e.disabled)&&d.log("",...o)},error:(...o)=>{!(e!=null&&e.disabled)&&d.error("",...o)},warn:(...o)=>{!(e!=null&&e.disabled)&&d.warn("",...o)},info:(...o)=>{!(e!=null&&e.disabled)&&d.info("",...o)},debug:(...o)=>{!(e!=null&&e.disabled)&&d.debug("",...o)},box:(...o)=>{!(e!=null&&e.disabled)&&d.box("",...o)},success:(...o)=>{!(e!=null&&e.disabled)&&d.success("",...o)},break:(...o)=>{!(e!=null&&e.disabled)&&console.log(`
`)}}),de=$();var _=(e,o)=>{for(let t in o){if(!o.hasOwnProperty(t)||t==="constructor"||t==="prototype"||t==="__proto__")continue;let n=o[t];N(n)?(n!==void 0||!(t in e))&&(e[t]=n):!e[t]||B(n)?e[t]=y(n):e[t]=_(e[t],n)}return e},B=e=>Array.isArray(e),N=e=>{if(e===null)return!0;let o=typeof e;return o!=="object"&&o!=="function"},ge=e=>{let o=y(e[0]);for(let t=1,n=e.length;t<n;t++)_(o,e[t]);return o};function ke(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ye(e,o){return m(this,null,function*(){let t=yield e.context.internalAdapter.findAccounts(o.userId),n=t==null?void 0:t.find(u=>u.providerId==="credential"),r=n==null?void 0:n.password;return!n||!r?!1:yield e.context.password.verify(r,o.password)})}import{generateState as I}from"oslo/oauth2";import{z as g}from"zod";function we(e,o,t){let n=I();return{state:JSON.stringify({code:n,callbackURL:e,currentURL:o,dontRememberMe:t}),code:n}}function Te(e){return g.object({code:g.string(),callbackURL:g.string().optional(),currentURL:g.string().optional(),dontRememberMe:g.boolean().optional()}).safeParse(JSON.parse(e))}export{ie as HIDE_METADATA,ke as capitalizeFirstLetter,y as clone,K as createCookieGetter,$ as createLogger,Y as deleteSessionCookie,ue as generateId,we as generateState,X as getBaseURL,W as getCookies,oe as getDate,re as getIp,de as logger,ge as merge,Z as parseSetCookieHeader,Te as parseState,Q as setSessionCookie,H as shimContext,V as shimEndpoint,ye as validatePassword};
